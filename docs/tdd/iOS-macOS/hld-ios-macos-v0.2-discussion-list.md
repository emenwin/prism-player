# Prism Player HLD v0.2 待讨论项目与改进项汇总

> 用途：在 TDD 与开发迭代中逐条细化与落地。本清单汇总自以下评审文档：
> - 评审一：`docs/tdd/reviews/hld-ios-macos-v0.2-review.md`
> - 评审二：`docs/tdd/reviews/hld-ios-macos-v0.2-review-gemini2.5.md`
> 日期：2025-10-17

---

## 高优先级（M1 前需明确/完成）

- [待讨论] VAD + 对齐方案的最终路径（非时间戳模型）——选择 VAD 库、对齐算法（DTW/能量峰值/CTC）、精度目标（±200ms）与失败回退至 whisper.cpp（来源：评审二 §3；评审一 §2.2）。
- [改进] 播放器/识别状态机与状态转移图补全——含并发冲突（快速 seek）处理与“仅处理最新 seekId”的规则（来源：评审一 §1.2）。
- [改进] 性能基准测试与回归框架——RTF/内存/能耗基线，覆盖不同设备档位，形成自动化对比（来源：评审一 §2.1；§3.3）。
- [待讨论] 依赖注入（DI）策略与测试架构——协议式 DI vs 容器（Swinject 等），Mock/Stub 约定与单元测试覆盖（来源：评审一 §1.1；§6.1）。

## 中优先级（M2 前应落地）

- [改进] 性能监控与降级逻辑——设计 PerformanceMonitor 指标采集与降级触发阈值/提示（来源：评审一 §3.3；§11-5）。
- [待讨论] 诊断包格式与隐私脱敏——日志分级（OSLog）、导出结构与敏感信息哈希/匿名化（来源：评审一 §5.2；§11-6）。
- [改进] CI/CD 流程矩阵与性能回归——多 OS/Xcode 版本构建、金样本回归、定期性能监测（来源：评审一 §9.2）。

## 低优先级（M3+ 可推进）

- [改进] 模型增量更新与签名验证——差分下载、SHA256 + 数字签名校验（来源：评审一 §2.3）。
- [待讨论] 平台抽象桥与 Catalyst 取舍——统一 PlatformBridge 协议与是否采用 Catalyst 的决策（来源：评审一 §1.3）。
- [改进] 用户可选 “性能/省电” 模式与阈值策略——低电量触发与 MetricKit 集成（来源：评审一 §3.2）。
- [改进] i18n 复数/RTL 与可访问性增强——复数规则、RTL 预留、VoiceOver/Reduce Motion/高对比度（来源：评审一 §7.2-7.3）。
- [改进] PR Checklist 与自动格式化——无硬编码、测试覆盖、VoiceOver 标签、swift-format（来源：评审一 §9.1）。
- [改进] 版本与 API 稳定性治理——SemVer、CHANGELOG、核心协议的 breaking change 管控（来源：评审一 §9.3）。
- [改进] 许可清单与展示——第三方与模型许可审查与 About 页展示（来源：评审一 §8.2）。

## 模块化条目（按主题细化）

- ASR/对齐
  - [待讨论] 时间戳缺失场景的对齐策略与验收标准（±200ms）；必要时评估引入强制对齐（Forced Alignment）微模型（来源：评审二 §3-2；评审一 §2.2）。
  - [改进] 双后端性能基线与回退自动化测试（MLX 不可用自动切换 whisper.cpp）（来源：评审一 §2.1）。
  - [改进] 模型兼容性矩阵维护与推荐设备标注（来源：评审一 §2.1）。

- 数据/状态
  - [改进] SubtitleStore 长视频持久化策略——即时写入 SQLite，内存仅保留“滑动窗口”段（来源：评审二 §3-1）。
  - [改进] 播放进度与识别进度的持久化与冷启动恢复策略（来源：评审一 §1.2）。

- 资源/性能
  - [改进] 组件级内存预算与 CI 内存泄漏检测（Instruments Leaks）（来源：评审一 §3.1）。
  - [待讨论] 能耗阈值（低电量、后台降速）的统一策略与用户控制（来源：评审一 §3.2）。

- 并发/调度
  - [待讨论] JobScheduler 实现细节——TaskGroup vs 自定义 AsyncStream、优先级 API、最大并发数限制（来源：评审一 §4.1）。
  - [改进] 死锁预防准则——单向依赖、避免 actor 间相互 await（来源：评审一 §4.1）。

- 错误处理/恢复
  - [改进] 各类错误的恢复路径细化——重试可否、退避策略、用户提示映射、最小可用降级（来源：评审一 §5.1）。
  - [改进] 结构化日志方案与分级（Debug/Info/Error）（来源：评审一 §5.2）。

- 测试策略
  - [改进] 单元/集成/性能/UI 测试覆盖清单与目标——金样本、WER、长视频稳定性、后台切换（来源：评审一 §6.1-6.2）。

- UI/UX/a11y/i18n
  - [改进] PrismUIKit 组件化与状态驱动 UI；关键动画 60fps（来源：评审一 §7.1）。
  - [改进] VoiceOver 实机流程测试与 Reduce Motion/高对比度支持（来源：评审一 §7.2）。
  - [改进] String Catalog 复数/RTL 适配与翻译评审流程（来源：评审一 §7.3）。

- 安全/隐私/合规
  - [改进] 隐私清单 PrivacyInfo.xcprivacy 与数据最小化（来源：评审一 §8.1）。
  - [改进] 第三方/模型许可的清单化与 About 页展示（来源：评审一 §8.2）。

- 工程实践
  - [改进] CI 流程（构建/测试/SwiftLint/金样本/归档）与多平台矩阵（来源：评审一 §9.2）。
  - [改进] 版本治理（SemVer/CHANGELOG）与核心协议变更沟通机制（来源：评审一 §9.3）。

- 风险跟踪（新增/重要）
  - [待讨论] MLX Swift 在 iOS 的成熟度与定位（macOS 优先，iOS 实验标注）（来源：评审一 §10.2）。
  - [改进] 长视频（>3h）稳定性压测与内存监控（来源：评审一 §10.2）。
  - [改进] 跨版本数据迁移失败的降级与迁移脚本测试（来源：评审一 §10.2）。
  - [改进] App Store 审核风险（模型下载）——首启引导与功能完整性说明（来源：评审一 §10.2）。

---

## 使用方式（TDD/开发中的落地建议）

- 在每次 TDD 编写前，从“高/中优先级”中选择需细化的 3-5 条，补充输入/输出、验收标准、边界条件与测试用例。
- 将条目转为 Backlog/Issue（Scrum），设置里程碑（M1/M2/M3）与负责人。
- 持续更新本文档，记录“已决/弃用/替代”结论，并链接到对应的 TDD 或实现 PR。

---

备注：如需在评审文本中定位上下文，请参考本文最上方的“来源”文件路径与相应章节号。
