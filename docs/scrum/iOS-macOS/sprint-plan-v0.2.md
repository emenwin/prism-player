# Prism Player Scrum Sprint 计划（v0.2）

> 版本：v0.2 规划稿  
> 日期：2025-10-17  
> 适用范围：对应 PRD v0.2 与 HLD iOS+macOS v0.2（离线字幕播放器）  
> 参考：`docs/scrum.md`（流程规范）、`docs/requirements/prd_v0.2.md`、`docs/tdd/hld-ios-macos-v0.2.md`

## 0. 概述

- 迭代节奏：每个 Sprint 2–4 周；以下按 3 个里程碑（M1/M2/M3）规划 3 个 Sprint。
- 产品目标摘要：本地播放 + 端侧离线 ASR，边播边出字幕；基础样式与 SRT/VTT 导出；模型下载/导入/删除；中英 i18n 与可访问性基线。
- KPI 对齐（PRD §2）：首帧字幕可见时间（P95）、时间同步偏差±200ms、RTF 处理率（≥0.3/0.5/1.0）、导出成功率≥99%。
- DoR/DoD：遵循 `docs/scrum.md`；DoD 额外要求：
  - 禁用硬编码字符串，采用 String Catalog（zh-Hans/en-US）。
  - SwiftLint 严格模式通过；关键模块最小单测覆盖（ViewModel/格式化/导出）。
  - Demo 可运行、可复现；PRD/HLD 引用与状态更新；风险与回退策略明示。

## 1. 里程碑与 Sprint 划分（与 PRD §10 对齐）

- Sprint 0（工程基线/仓库初始化，建议 1 周）
  - 目标：建立工程基线，完成仓库与编码规范、构建配置、基础自动化与模板，确保 M1 开发可顺畅启动。
  - 范围与 PBIs
   1) 仓库初始化与协作规范
     - 初始化 Git 分支策略（main/dev/feature-*），提交 message 规范（Conventional Commits）。
     - 配置 .gitignore、LICENSE（依第三方许可评审，暂用 MIT 占位）、README 骨架与贡献指南（CONTRIBUTING）。
     - 配置 CODEOWNERS、Issue/PR 模板（Bug/Feature/Tech Debt/Spike）。
   2) iOS/macOS 多平台工程脚手架（HLD §13）
     - 创建 Xcode 多平台工程与 Swift Package 结构：packages/PrismCore、PrismASR、PrismKit；apps 目标（iOS/macOS）。
     - 配置 BundleID 占位、最小系统版本（iOS 17+/macOS 14+，可在 Planning 时确认）。
   3) 代码规范与质量基线
     - 引入 SwiftLint（严格模式）与基本规则；在 CI 中启用 Lint 检查。
     - 初始化 String Catalog（.xcstrings）并接入本地化管线（zh-Hans/en-US），禁用硬编码字符串检查清单。
   4) 构建与 CI 基线
     - 设置 GitHub Actions/GitLab CI（占位工作流）：构建 iOS/macOS、运行 Lint、（后续）单元测试。
     - 缓存依赖与签名占位说明（不提交证书）；可选 Fastlane 骨架（后续接入）。
   5) 数据与存储占位
     - 选定 SQLite 接入方案（原生/GRDB），创建空 schema 迁移版本号与迁移框架。
     - 定义应用沙盒路径约定与文件夹结构（Models/AudioCache/Exports）。
   6) 安全/隐私与合规占位
     - 初始化 PrivacyInfo.xcprivacy 占位；Info.plist 权限占位（文件访问说明文案本地化）。
     - 第三方与模型许可清单模板，在“关于”页待办。
   7) 指标与日志占位
     - 统一日志方案（OSLog 分类与级别），Metrics 记录接口占位（首帧、RTF）。
   8) 开发体验
     - 可选 pre-commit hook（lint/format）；swift-format 评估（与 SwiftLint 协同）。
  - 交付物
   - 可构建的多平台工程与 Package 结构；CI 工作流运行成功；Lint 生效；本地化与隐私占位文件；Issue/PR 模板。
  - 风险与回退
   - CI 签名受限 → 仅跑 Debug 构建与单测；发布签名另行配置。
   - 依赖选择未定 → 以原生方案占位，后续可替换为 GRDB 等。

- Sprint 1（M1 原型，2 周）
  - 目标：端到端最小可用链路（本地媒体→预加载→离线 ASR→基础字幕渲染→SRT 导出）。
- Sprint 2（M2 可用版，3 周）
  - 目标：增量识别与滚动字幕、模型管理与语言选择、缓存与倍速适配、VTT 可选、macOS 目标跑通。
- Sprint 3（M3 优化版，3 周）
  - 目标：性能与能耗优化、抢占识别（seek 后 60s）、质量感知与按段重识别、a11y 完善、长视频策略与稳定性。

注：具体周数可在 Sprint Planning 时根据团队容量微调（±1 周）。

---

## 2. Sprint 1（M1 原型，建议 2 周）

- Sprint Goal
  - 实现“选择本地媒体后，数秒内看到首帧字幕，播放中有基础字幕显示，并可导出 SRT”。

- 范围与 PBIs（含来源与验收映射）
  1) 媒体选择与播放（PRD §6.1；用户故事 §5-1/2）
     - 验收：支持本地视频/音频选择；播放/暂停；进度回调为字幕渲染提供时钟源（HLD §2.2 PlayerService）。
  2) 音频预加载与极速首帧（PRD §6.2；KPI §2）
     - 验收：默认预加载 30s；首帧快速窗 5–10s 并行抽取（HLD §5 预加载）。
  3) 离线 ASR 基线（WhisperCppBackend）（HLD §6.2；PRD §3/§6.4/§6.7-离线）
     - 验收：加载本地超轻量模型（内置 Demo 或本地导入）；产出带时间戳的 Segment（精度以 Demo 为准）。
  4) 字幕渲染（基础样式）与同步（PRD §6.4/§6.5）
     - 验收：以播放器时间为唯一时钟；底部居中；字号 1 档、主题默认；偏差容差目标±200ms（记录实测）。
  5) SRT 导出（基础）（PRD §6.6；用户故事 §5-5）
     - 验收：UTF-8；<源文件名>.<locale>.srt；时间戳格式正确；避免覆盖；空间检查基础提示。
  6) 工程与规范基线
     - 结构：Xcode 多平台工程 + Packages（PrismCore/PrismASR/PrismKit）（HLD §13）。
     - 规范：SwiftLint 严格；String Catalog 初始化（zh-Hans/en-US）。
  7) 指标与诊断（最小化）
     - 记录首帧时间、段耗时样本（HLD §6.7/§2.1 指标对齐）；本地日志。

- 交付物
  - 可运行原型（iOS）；短视频 Demo；导出 SRT 样例；简要性能记录（首帧/RTF 样本）。

- 风险与回退
  - 设备性能不足：降级更小模型/缩短窗长；明确 UI 提示（PRD §12）。
  - 时间戳偏差：先满足“看得上”，记录差值，后续优化（Sprint 3）。

---

## 3. Sprint 2（M2 可用版，建议 3 周）

- Sprint Goal
  - 完成滚动增量识别与模型管理，改善使用体验与可用性，支持 macOS 基线。

- 范围与 PBIs
  1) 增量识别与滚动字幕（PRD §6.4；用户故事 §5-2）
     - 验收：按 15–30s 段滚动抽取与识别，增量落盘并驱动 UI（HLD §5 滚动识别）。
  2) 进度拖动后的优先识别（基础版）（PRD §5-3；§6.4）
     - 验收：seek 后展示已识别片段，未识别片段显示占位；识别队列对“seek 点起后窗口”提高优先级（简化版）。
  3) 缓存与内存策略（基础）（PRD §6.2；HLD §7）
     - 验收：音频缓存 ≤10MB，LRU 淘汰；内存警告仅保留“当前 ±15s”。
  4) 模型管理（下载/导入/删除）与语言选择（PRD §6.3/§6.7）
     - 验收：展示大小/进度/校验（SHA256）；存储空间检查；保留至少一个可用模型；语言自动/手动选择与持久化。
  5) 倍速播放适配（0.5–2.0x）（PRD §6.1/§6.4）
     - 验收：字幕显示时长与播放速度等比；识别明显落后时弱提示。
  6) VTT 导出（可选增强）（PRD §6.6）
  7) macOS 目标最小可用（HLD §3；平台适配）
     - 验收：文件打开（NSOpenPanel）、播放、基础识别与渲染、导出。
  8) 设置页与一键清理（PRD §6.7）
     - 验收：预加载时长 10/30/60s；缓存清理入口；最近一次语言与模型记忆。
  9) 指标与离线统计（基础）
     - 验收：首帧时间、RTF、段失败率本地记录，支持问题反馈包开关雏形（不含原媒体）。

- 交付物
  - iOS + macOS 可用版；模型管理 UI；缓存策略落地；VTT（如启用）。

- 风险与回退
  - 后台/能耗：iOS 播放中可继续识别；非播放任务化到后续；提供状态提示（PRD §7-2）。
  - 下载失败/空间不足：进度与重试、清理工具、失败可恢复提示（PRD §6.3/§6.8）。

---

## 4. Sprint 3（M3 优化版，建议 3 周）

- Sprint Goal
  - 达成性能与稳定性目标，完善用户感知质量与错误/诊断体系，完成可访问性与长视频策略。

- 范围与 PBIs
  1) 抢占式调度完善（seek 后 60s 窗口优先）（PRD §5-3；HLD §2.2/§5 拖动抢占）
     - 验收：抢占优先级 > 滚动 > 预加载；取消过期任务；公平性与背压策略。
  2) 性能与能耗优化（PRD §7；KPI §2）
     - 验收：不同档位设备 RTF/首帧达标或给出降级提示；段间节流与后台降速；热管理。
  3) 质量感知与按段重识别（增强）（PRD §6.9）
     - 验收：低置信度弱提示样式；按段“用高精度模型重识别”入口与耗时提示。
  4) 错误处理与诊断包（PRD §6.8；HLD §8）
     - 验收：统一状态与错误码；问题反馈包（配置/设备/时序日志，脱敏）。
  5) 长视频策略与持久化（PRD §6.2；HLD §4/§7）
     - 验收：仅按需提取与增量落盘；冷启动恢复进度；内存不随时长线性增长。
  6) a11y 与 i18n 完善（PRD §7-可访问性/国际化）
     - 验收：动态字体/对比度达标；屏幕阅读器标签；无硬编码；复数/RTL 预留。
  7) 测试与 CI 增强（HLD §13；讨论清单）
     - 验收：金样本短音频回归、基础 WER 指标、内存泄漏检查、构建矩阵（iOS 17+/macOS 14+）。

- 交付物
  - 优化版应用；性能与稳定性报告；问题反馈包原型；测试与 CI 报告。

- 风险与回退
  - VAD/对齐精度（非时间戳模型）：必要时回退至 whisper.cpp；UI 明示精度提示（讨论清单）。
  - MLX 后端在 iOS 的成熟度：macOS 优先，iOS 标注实验特性（HLD §6.3/§6.8）。

---

## 5. 验收与度量（跨 Sprint）

- 验收口径
  - 用户故事（PRD §5）逐项通过；Out of Scope 不提前引入（PRD §11）。
  - 导出：SRT 正确、UTF-8、时间戳准确；失败可重试（PRD §11）。
  - 隐私：默认离线，不上传媒体/字幕（PRD §7-隐私）。
- 关键指标（PRD §13）
  - 首帧时间、RTF、识别段耗时、失败率、导出使用率、模型选择分布。
  - 每 Sprint Review 展示最新样本与趋势；如未达标，提出降级或优化计划。

## 6. 角色与会议节奏

- 角色：PO、开发、QA（可轮值）、架构/性能（跨职能）。
- 会议：遵循 `docs/scrum.md`（Planning、Daily、Review、Retro）。
- 工件：Product Backlog、Sprint Backlog、Increment；燃尽图与指标面板（轻量）。

## 7. 依赖与风险清单（摘要）

- 依赖
  - whisper.cpp 集成与 Metal/Accelerate 可用性；URLSession 背景下载（iOS）。
  - SQLite/GRDB 可用性与沙盒权限；String Catalog 国际化流程。
- 风险与对策（选）
  - 低端设备性能不足 → 模型降级/窗长缩短/节流与提示（PRD §12）。
  - 存储空间压力 → 模型体积提示与一键清理（PRD §12）。
  - 语言检测误差 → 允许手动选择与持久化（PRD §12）。
  - 系统后台限制 → 明确状态与恢复策略（PRD §7-后台行为）。

## 8. 追踪与交付物模板

- 每个 PBI 包含：
  - 描述、来源引用（PRD/HLD 章节）、验收标准（AC）、估算（SP）、依赖、测试要点、降级/回退策略。
- Demo Checklist（每次 Review）
  - 场景：首帧出字、滚动识别、seek 抢占、样式切换、导出、模型管理、倍速适配、缓存清理。
  - 指标：首帧时间、RTF 样本、导出成功率、错误提示示例。

---

附：建议的初始 Backlog（摘要与估算示例）
- Sprint 1（合计 ~36 SP）
  - 播放器与进度时钟（5）/ 预加载与极速窗（8）/ ASR 最小链路（13）/ 渲染与样式基础（5）/ SRT 导出（3）/ 规范与 i18n 基线（2）
- Sprint 2（合计 ~56 SP）
  - 滚动识别（13）/ seek 优先识别基础（8）/ 缓存与 LRU（8）/ 模型管理与语言（13）/ 倍速适配（5）/ VTT（3）/ macOS 基线（6）
- Sprint 3（合计 ~58 SP）
  - 抢占式调度完善（13）/ 性能与能耗优化（13）/ 质量感知与重识别（8）/ 错误与诊断包（8）/ 长视频策略（8）/ a11y 与 i18n 完善（4）/ 测试与 CI 增强（4）

说明：SP 为示例，实际在 Sprint Planning 时按团队口径细化与校准。
