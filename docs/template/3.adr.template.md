<!-- 
æ¨¡æ¿åç§°ï¼šADR æ¶æ„å†³ç­–è®°å½•
é€‚ç”¨åœºæ™¯ï¼šå…³é”®æŠ€æœ¯å†³ç­–æ—¶åˆ›å»º
å¡«å†™æŒ‡å—ï¼š
  - ğŸ”´ å¿…å¡«é¡¹ï¼šç¬¬ 1-5 èŠ‚
  - ğŸŸ¡ å¯é€‰é¡¹ï¼šç¬¬ 7 èŠ‚ï¼ˆå¦‚æ— ç‰¹æ®Šæƒ…å†µå¯çœç•¥ï¼‰
  - â±ï¸ é¢„ä¼°è€—æ—¶ï¼š1-2 å°æ—¶
  - ğŸ“ Review æ£€æŸ¥æ¸…å•ï¼šæ–¹æ¡ˆå¯¹æ¯”å®Œæ•´ã€å†³ç­–ç†ç”±æ˜ç¡®ã€å½±å“åˆ†ææ¸…æ™°
ç›¸å…³æ¨¡æ¿ï¼šåŸºäº 0.prd.template.mdï¼Œå¯èƒ½å¼•ç”¨ 4.tdd.template.md
-->

# ADR-XXXX: [ç®€çŸ­æ ‡é¢˜]

## çŠ¶æ€
- **æè®®ä¸­** / **å·²æ¥å—** / **å·²åºŸå¼ƒ** / **å·²æ›¿ä»£**
- æ—¥æœŸï¼šYYYY-MM-DD
- **æè®®äºº**ï¼š[@username]
- **å®¡æŸ¥è€…**ï¼š[@reviewer1, @reviewer2]
- **å†³ç­–è€…**ï¼š[@tech-lead] æˆ– Team Consensus
- ç›¸å…³æ–‡æ¡£ï¼š[PRD Â§X.X, HLD Â§Y.Y, Sprint Plan Sprint N]

## ç›¸å…³å†³ç­–
- **æ›¿ä»£**ï¼š[ADR-XXXX]ï¼ˆæœ¬ ADR åºŸå¼ƒäº†æ—§æ–¹æ¡ˆï¼Œè¯´æ˜åŸå› ï¼‰
- **è¡¥å……**ï¼š[ADR-XXXX]ï¼ˆä¸æœ¬ ADR ååŒå·¥ä½œï¼Œè¯´æ˜å…³ç³»ï¼‰
- **å†²çª**ï¼šæ—  / [ADR-XXXX]ï¼ˆéœ€è¦åè°ƒï¼Œè¯´æ˜å†²çªç‚¹ï¼‰
- **ä¾èµ–**ï¼š[ADR-XXXX]ï¼ˆæœ¬å†³ç­–åŸºäºè¯¥ ADR çš„åŸºç¡€ï¼‰

## èƒŒæ™¯ä¸é—®é¢˜é™ˆè¿°
<!-- æè¿°éœ€è¦åšå‡ºå†³ç­–çš„æŠ€æœ¯æˆ–ä¸šåŠ¡åœºæ™¯ -->
æˆ‘ä»¬éœ€è¦ä¸º Prism Player é€‰æ‹©ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ–¹æ¡ˆï¼Œä»¥æ”¯æŒï¼š
- åè®®é©±åŠ¨çš„æµ‹è¯•ï¼ˆMock AsrEngineã€PlayerServiceï¼‰
- å¤šå¹³å°å…±äº«ä»£ç ï¼ˆiOS/macOSï¼‰
- æœ€å°åŒ–æ ·æ¿ä»£ç ï¼Œä¿æŒ Swift åŸç”Ÿé£æ ¼

## å†³ç­–é©±åŠ¨å› ç´ 
<!-- å½±å“å†³ç­–çš„å…³é”®å› ç´  -->
- **æµ‹è¯•æ€§**ï¼šå¿…é¡»æ”¯æŒ Mock/Stub æ³¨å…¥
- **å­¦ä¹ æ›²çº¿**ï¼šå›¢é˜Ÿç†Ÿæ‚‰ Swift åè®®ä¸æ³›å‹
- **æ€§èƒ½**ï¼šé¿å…è¿è¡Œæ—¶åå°„å¼€é”€
- **ä¾èµ–**ï¼šä¼˜å…ˆåŸç”Ÿæ–¹æ¡ˆï¼Œé¿å…å¼•å…¥é‡é‡çº§æ¡†æ¶

## è€ƒè™‘çš„æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šåè®®å¼ DIï¼ˆProtocol-based DIï¼‰
```swift
// åè®®å®šä¹‰ä¾èµ–
protocol AsrEngine {
    func transcribe(...) async throws -> [Segment]
}

// åˆå§‹åŒ–å™¨æ³¨å…¥
class TranscriptionService {
    private let asrEngine: AsrEngine
    init(asrEngine: AsrEngine) {
        self.asrEngine = asrEngine
    }
}

// æµ‹è¯•æ—¶æ³¨å…¥ Mock
class MockAsrEngine: AsrEngine { ... }
let service = TranscriptionService(asrEngine: MockAsrEngine())
```

**ä¼˜ç‚¹**ï¼š
- âœ… åŸç”Ÿ Swiftï¼Œé›¶ä¾èµ–
- âœ… ç¼–è¯‘æœŸç±»å‹å®‰å…¨
- âœ… æµ‹è¯•å‹å¥½ï¼ŒMock æ¸…æ™°
- âœ… æ€§èƒ½æ— æŸ

**ç¼ºç‚¹**ï¼š
- âš ï¸ æ·±å±‚ä¾èµ–æ ‘éœ€æ‰‹åŠ¨ä¼ é€’
- âš ï¸ ç¼ºä¹å…¨å±€å®¹å™¨ç®¡ç†

---

### æ–¹æ¡ˆ 2ï¼šè½»é‡çº§å®¹å™¨ï¼ˆLightweight Containerï¼‰
```swift
// ç®€å•æœåŠ¡å®šä½å™¨
class ServiceContainer {
    static let shared = ServiceContainer()
    private var services: [String: Any] = [:]
    
    func register<T>(_ type: T.Type, instance: T) {
        services[String(describing: type)] = instance
    }
    
    func resolve<T>(_ type: T.Type) -> T {
        guard let service = services[String(describing: type)] as? T else {
            fatalError("Service not registered: \(type)")
        }
        return service
    }
}
```

**ä¼˜ç‚¹**ï¼š
- âœ… é›†ä¸­ç®¡ç†ä¾èµ–
- âœ… å‡å°‘æ‰‹åŠ¨ä¼ é€’

**ç¼ºç‚¹**ï¼š
- âš ï¸ è¿è¡Œæ—¶é”™è¯¯é£é™©
- âš ï¸ ç±»å‹å®‰å…¨å¼±åŒ–
- âš ï¸ æµ‹è¯•æ—¶éœ€é‡ç½®å®¹å™¨

---

### æ–¹æ¡ˆ 3ï¼šç¬¬ä¸‰æ–¹æ¡†æ¶ï¼ˆSwinject/Needleï¼‰
**ä¼˜ç‚¹**ï¼š
- âœ… åŠŸèƒ½å®Œå–„ï¼ˆä½œç”¨åŸŸã€è‡ªåŠ¨æ³¨å…¥ï¼‰

**ç¼ºç‚¹**ï¼š
- âŒ å­¦ä¹ æˆæœ¬é«˜
- âŒ å¼•å…¥å¤–éƒ¨ä¾èµ–
- âŒ è¿‡åº¦è®¾è®¡ï¼ˆå¯¹å½“å‰é¡¹ç›®ï¼‰

## å†³ç­–ç»“æœ
**é€‰æ‹©æ–¹æ¡ˆ 1ï¼šåè®®å¼ DI**

### ç†ç”±
1. ç¬¦åˆ Swift æœ€ä½³å®è·µä¸å›¢é˜ŸæŠ€èƒ½æ ˆ
2. æµ‹è¯•è¦†ç›–ç‡ç›®æ ‡ï¼ˆCoreâ‰¥70%ï¼‰éœ€è¦æ¸…æ™° Mock ç­–ç•¥
3. é¡¹ç›®è§„æ¨¡å¯æ§ï¼Œä¾èµ–æ ‘æ·±åº¦â‰¤3 å±‚
4. é¿å…å¼•å…¥å¤–éƒ¨ä¾èµ–ï¼ˆç¬¦åˆ DoRï¼‰

### å®æ–½ç»†èŠ‚
- æ ¸å¿ƒåè®®å®šä¹‰åœ¨ `PrismCore`ï¼ˆAsrEngineã€PlayerServiceã€StorageServiceï¼‰
- Mock å®ç°ç»Ÿä¸€æ”¾ç½® `Tests/Mocks/`
- ViewModel é€šè¿‡åˆå§‹åŒ–å™¨æ³¨å…¥æœåŠ¡
- SwiftUI Preview ä½¿ç”¨ Mock æœåŠ¡

### ç¤ºä¾‹ä»£ç ï¼ˆæœ€å°å¯éªŒè¯ç¤ºä¾‹ï¼‰
```swift
// filepath: packages/PrismCore/Sources/AsrEngine.swift
public protocol AsrEngine {
    func transcribe(audioData: Data, options: AsrOptions) async throws -> [AsrSegment]
}

// filepath: packages/PrismASR/Sources/WhisperCppBackend.swift
public final class WhisperCppBackend: AsrEngine {
    public func transcribe(...) async throws -> [AsrSegment] {
        // whisper.cpp å®ç°
    }
}

// filepath: Tests/Mocks/MockAsrEngine.swift
final class MockAsrEngine: AsrEngine {
    var transcribeResult: [AsrSegment] = []
    func transcribe(...) async throws -> [AsrSegment] {
        return transcribeResult
    }
}

// ä½¿ç”¨ç¤ºä¾‹ï¼ˆéªŒè¯å¯è¡Œæ€§ï¼‰
let engine: AsrEngine = WhisperCppBackend()
let result = try await engine.transcribe(audioData: data, options: .default)

// æµ‹è¯•ç¤ºä¾‹
func testTranscription() async throws {
    let mockEngine = MockAsrEngine()
    mockEngine.transcribeResult = [AsrSegment(text: "Hello", start: 0, end: 1)]
    let service = TranscriptionService(asrEngine: mockEngine)
    let result = try await service.process(data)
    XCTAssertEqual(result.count, 1)
}
```

## åæœ

### æ­£é¢å½±å“
- å•å…ƒæµ‹è¯•æ¸…æ™°å¯æ§
- ç¼–è¯‘æœŸæ•è·ä¾èµ–é”™è¯¯
- ä»£ç å¯è¯»æ€§é«˜

### è´Ÿé¢å½±å“
- ViewModel åˆå§‹åŒ–éœ€æ˜¾å¼ä¼ å‚ï¼ˆå¯é€šè¿‡å·¥å‚æ–¹æ³•ç¼“è§£ï¼‰
- æ·±å±‚ä¾èµ–æ ‘éœ€æ‰‹åŠ¨ä¼ é€’ï¼ˆå½“å‰é¡¹ç›®æ·±åº¦â‰¤3 å¯æ¥å—ï¼‰

### ç¼“è§£æªæ–½
- æä¾› `Dependencies` å‘½åç©ºé—´èšåˆå¸¸ç”¨ä¾èµ–
```swift
struct Dependencies {
    let asrEngine: AsrEngine
    let playerService: PlayerService
    let storage: StorageService
}
```

## éµä»æ€§
- æ‰€æœ‰æ–°å¢æœåŠ¡å¿…é¡»å®šä¹‰åè®®
- ç¦æ­¢ç›´æ¥å®ä¾‹åŒ–å…·ä½“ç±»å‹ï¼ˆé™¤ SwiftUI Viewï¼‰
- CI æ£€æŸ¥ï¼šMock è¦†ç›–ç‡â‰¥70%ï¼ˆCore/Kit å±‚ï¼‰

## ç›¸å…³å†³ç­–
- æ›¿ä»£ï¼šæ— 
- å»¶ç»­ï¼šADR-0004ï¼ˆçŠ¶æ€æœºè®¾è®¡ä¹Ÿé‡‡ç”¨åè®®æŠ½è±¡ï¼‰
- å†²çªï¼šæ— 

## å¤‡æ³¨
- Sprint 0 å®ŒæˆåŸºç¡€ç¤ºä¾‹ï¼ˆMock AsrEngine + PlayerServiceï¼‰
- Sprint 1 å…¨é¢åº”ç”¨äºæ ¸å¿ƒæœåŠ¡

## å‚è€ƒèµ„æ–™
- [Swift API Design Guidelines](https://www.swift.org/documentation/api-design-guidelines/)
- [Testing Swift: Protocol-Oriented Mocking](https://www.swiftbysundell.com/articles/protocol-oriented-programming-in-swift/)
- Michael Nygard, "Documenting Architecture Decisions" (2011)

---

**æ¨¡æ¿ç‰ˆæœ¬**: v1.1  
**æœ€åæ›´æ–°**: 2025-10-30  
**å˜æ›´è®°å½•**:
- v1.1 (2025-10-30): æ–°å¢å®¡æŸ¥è€…å­—æ®µã€ç›¸å…³å†³ç­–è¯´æ˜ã€æœ€å°å¯éªŒè¯ç¤ºä¾‹
- v1.0 (2025-10-24): åˆå§‹ç‰ˆæœ¬