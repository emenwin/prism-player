<!-- 
模板名称：Task 详细设计
适用场景：复杂任务（3+ SP）需要详细设计时创建
填写指南：
  - 🔴 必填项：第 1-5 节
  - 🟡 可选项：第 6-7 节（如无观测需求可省略）
  - ⏱️ 预估耗时：1-2 小时
  - 📝 Review 检查清单：实施步骤清晰、测试用例完整、DoD 已确认
相关模板：基于 4.tdd.template.md，最终提交 PR
-->

# Task 详细设计模板

- Sprint：Sx
- Task：Task-XXX 标题
- PBI：链接/编号
- Owner：@
- 状态：Todo | In Progress | Review | Done

## 相关 TDD
- [ ] 在此添加链接（例如：`tdd/iOS-macOS/hld-ios-macos-vX.Y.md` 或 `tdd/Android/hld-android-vX.Y.md`）— 用一句话写出关键约束

## 相关 ADR
- [ ] 在此添加关联 ADR（例如：`docs/adr/iOS-macOS/0004-logging-metrics-strategy.md`）— 用一句话写出主要影响

## 1. 目标与范围
- 目标（可量化）：…
- 范围 / 非目标：…

## 2. 方案要点（引用为主）
- 采用的接口/约束/契约：见 TDD §x.x、ADR-00xx
- **与 TDD 差异的本地实现细节**（如有）：
  1. **偏差内容**：[描述与 HLD 的差异]
  2. **原因**：[为什么需要偏离 HLD]
  3. **影响**：[对其他模块的影响]
  4. **后续**：是否需要更新 HLD ✅ / ❌

## 3. 改动清单
- 影响模块/文件：packages/…、apps/…
- 接口/协议变更（如有）：签名、错误语义、兼容性
- 数据/迁移（如有）：步骤与回滚

## 4. 实施计划
- PR 拆分与步骤：PR1 …，PR2 …
- 特性开关/灰度：开关名、启停条件

## 5. 测试与验收
- **单测**：
  - 用例：正常流程、边界条件、异常处理
  - 夹具：`Tests/Fixtures/audio/sample-10s.wav`（已准备 ✅ / 需创建 ⏳）
  - 覆盖率目标：≥ 80%（核心逻辑）
- **集成/E2E**：
  - 场景：[完整用户旅程描述]
  - 断言：[具体验证点]
  - 夹具：[测试数据位置]
- **验收标准**：
  - [ ] 所有单测通过（覆盖率 ≥ 80%）
  - [ ] 集成测试通过
  - [ ] 性能测试：[具体指标，如 RTF ≥ 0.5]

## 6. 观测与验证
- 日志/指标/追踪埋点：字段、频率、阈值
- 验证方法：本地、CI、真机

## 7. 风险与未决
- 风险 A：缓解 … / 负责人 / 截止时间

## 定义完成（DoD）
- [ ] CI 通过（构建/测试/SwiftLint 严格模式）
- [ ] 无硬编码字符串（国际化）
- [ ] **文档更新**：
  - [ ] README（如新增模块/依赖）
  - [ ] CHANGELOG（记录变更）
  - [ ] HLD（如设计有偏差需同步）
- [ ] 关键路径测试覆盖与可观测埋点到位
- [ ] Code Review 通过

---

**模板版本**: v1.1  
**最后更新**: 2025-10-30  
**变更记录**:
- v1.1 (2025-10-30): 新增设计偏差说明、测试数据/夹具字段、文档更新检查清单
- v1.0 (2025-10-24): 初始版本
