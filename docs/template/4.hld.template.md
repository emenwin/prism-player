<!-- 
模板名称：HLD 高层设计文档（精简版）
适用场景：系统/模块的详细设计，模块划分和交互设计
填写指南：
  - 🔴 必填项：第 1-6 节（背景、需求、模块设计、数据设计、接口设计、流程设计）
  - 🟡 可选项：第 7-8 节（根据项目复杂度决定）
  - ⏱️ 预估耗时：4-6 小时
  - 📝 Review 检查清单：模块职责清晰、依赖关系明确、接口契约完整、数据流清晰
文档分层：
  - 上游：ADD（架构设计） - 定义整体架构风格和技术选型
  - 本层：HLD（高层设计） - 定义模块划分和交互方式
  - 下游：TDD（详细设计） - 定义具体实现逻辑和代码结构
-->

# 高层设计文档（HLD）

> **文档类型**: 高层设计文档  
> **版本**: vX.Y  
> **最后更新**: YYYY-MM-DD  
> **维护人**: @[负责人]  
> **状态**: [Draft | Review | Approved | Deprecated]

---

## 文档关联

**上游文档**：
- **ADD**: `docs/1_design/architecture/add-[name]-vX.Y.md`（架构设计）
- **ADR**: 
  - ADR-000X [标题](链接) — 状态：[Accepted/Proposed] — 影响：[一句话说明]
- **PRD**: `docs/0_prd/prd_vX.Y.md`（产品需求）

**本文档范围**：
- ✅ 模块划分与职责
- ✅ 模块间依赖关系
- ✅ 接口契约定义（协议签名）
- ✅ 数据模型与数据流
- ✅ 关键业务流程
- ❌ 架构风格选择（见 ADD）
- ❌ 具体代码实现（见 TDD）

**下游文档**：
- **TDD**: `docs/1_design/tdd/[module]/tdd-[name]-vX.Y.md`（详细技术设计）

---

## 文档修订历史

| 版本 | 日期 | 作者 | 变更说明 | 关联 TDD/Task |
|------|------|------|---------|--------------|
| v0.1 | YYYY-MM-DD | [作者] | 初始版本 | - |

---

## 1. 背景与目标

### 1.1 设计背景

**业务背景**：
- [描述项目背景、业务场景]
- [现有问题或痛点]

**架构决策依据**：
[引用 ADD 中的相关决策，不重复描述]
- **架构风格**: [如：模块化分层架构] → 详见 ADD 第 X.X 节
- **技术选型**: [关键技术栈] → 详见 ADD 第 X.X 节
- **质量属性**: [优先级排序] → 详见 ADD 第 X.X 节

### 1.2 设计目标

**功能目标**：
- [目标 1]：[具体说明]
- [目标 2]：[具体说明]

**质量目标**：

| 质量属性 | 具体指标 | 测量方式 | 验收标准 |
|---------|---------|---------|---------|
| [性能] | [指标] | [方式] | [标准] |
| [可靠性] | [指标] | [方式] | [标准] |
| [可维护性] | [指标] | [方式] | [标准] |

### 1.3 设计范围

**范围内**：
- [本次设计覆盖的模块/功能]

**范围外**（明确不包含）：
- [暂不实现的功能]

### 1.4 约束与前提

**技术约束**：
- [约束 1]：[说明]
- [约束 2]：[说明]

**业务约束**：
- [约束 1]：[说明]

**假设前提**：
- [假设 1]：[说明及验证方式]

---

## 2. 需求概览

### 2.1 功能需求梳理

[从 PRD 提炼的核心功能需求]

| 需求 ID | 需求描述 | 优先级 | 复杂度 | 关联模块 |
|---------|---------|--------|--------|---------|
| F-001 | [需求描述] | P0 | 高 | [模块名] |
| F-002 | [需求描述] | P1 | 中 | [模块名] |

### 2.2 非功能需求

| 类型 | 需求描述 | 目标值 | 测量方式 |
|-----|---------|--------|---------|
| 性能 | [描述] | [目标] | [方式] |
| 可用性 | [描述] | [目标] | [方式] |
| 安全性 | [描述] | [目标] | [方式] |

### 2.3 关键用例

#### 用例 1: [用例名称]

**场景描述**: [一句话描述]

**前置条件**:
- [条件 1]

**主流程**:
1. [步骤 1]
2. [步骤 2]

**后置条件**:
- [结果状态]

**异常处理**:
- [异常情况] → [处理方式]

---

## 3. 系统设计概览

### 3.1 架构决策引用

[引用 ADD 中的关键决策，说明对本设计的影响]

| ADR | 决策内容 | 对本设计的影响 |
|-----|---------|---------------|
| ADR-000X | [决策标题] | [影响说明] |

### 3.2 模块总览

**整体架构图**：

```
[绘制模块分层图 - Mermaid 或 ASCII]

示例：
┌─────────────────────────────────────┐
│        应用层 (App Layer)            │
├─────────────────────────────────────┤
│      UI 层 (Presentation Layer)      │
├─────────────────────────────────────┤
│    业务逻辑层 (Business Layer)        │
├─────────────────────────────────────┤
│      数据层 (Data Layer)             │
├─────────────────────────────────────┤
│    基础设施层 (Infrastructure)        │
└─────────────────────────────────────┘
```

**模块列表**：

| 模块名称 | 职责 | 依赖模块 | 关键技术 |
|---------|------|---------|---------|
| [模块 A] | [职责描述] | [依赖] | [技术] |
| [模块 B] | [职责描述] | [依赖] | [技术] |

### 3.3 设计方案对比（可选）

[如果有多个备选方案，列出对比]

| 方案 | 优点 | 缺点 | 适用场景 | 选择 |
|-----|------|------|---------|------|
| 方案 A | [优点] | [缺点] | [场景] | ✅ 推荐 |
| 方案 B | [优点] | [缺点] | [场景] | ❌ 备选 |

**选择理由**: [说明为什么选择方案 A]

---

## 4. 模块详细设计

### 4.1 模块依赖关系

**依赖图**：

```
[绘制模块依赖关系图 - Mermaid]

示例：
graph TD
    A[模块A] --> B[模块B]
    A --> C[模块C]
    B --> D[模块D]
    C --> D
```

**依赖说明**：

| 依赖方 | 被依赖方 | 依赖类型 | 说明 |
|-------|---------|---------|------|
| [模块 A] | [模块 B] | [强依赖/弱依赖] | [说明] |

### 4.2 模块职责定义

#### 4.2.1 [模块 A 名称]

**职责**：
- [职责 1]
- [职责 2]

**对外接口**：
- [接口名称]：[功能描述]

**内部组件**：
- [组件 1]：[职责]
- [组件 2]：[职责]

**依赖**：
- [依赖模块]：[使用什么功能]

**数据**：
- **输入**: [数据类型]
- **输出**: [数据类型]
- **存储**: [是否持久化]

**关键约束**：
- [约束 1]
- [约束 2]

#### 4.2.2 [模块 B 名称]

[按照相同格式描述]

---

## 5. 数据设计

### 5.1 数据模型

#### 5.1.1 核心实体

**实体关系图（ERD）**：

```
[绘制 ER 图 - Mermaid]

示例：
erDiagram
    实体A ||--o{ 实体B : 关系
    实体B ||--|| 实体C : 关系
```

**实体定义**：

##### 实体 A: [实体名称]

| 字段名 | 类型 | 必填 | 说明 | 约束 |
|-------|------|------|------|------|
| id | String | ✅ | 唯一标识 | 主键, UUID |
| name | String | ✅ | 名称 | 长度 1-100 |
| createdAt | Date | ✅ | 创建时间 | 自动生成 |

**业务规则**：
- [规则 1]
- [规则 2]

### 5.2 数据流设计

#### 5.2.1 关键数据流

**数据流图**：

```
[绘制数据流向图 - Mermaid]

示例：
sequenceDiagram
    用户 ->> 模块A: 请求数据
    模块A ->> 模块B: 查询
    模块B ->> 数据库: SQL
    数据库 -->> 模块B: 结果
    模块B -->> 模块A: 返回
    模块A -->> 用户: 响应
```

**流程说明**：
1. [步骤 1]: [说明]
2. [步骤 2]: [说明]

### 5.3 数据存储

**存储策略**：

| 数据类型 | 存储方式 | 生命周期 | 大小限制 | 备份策略 |
|---------|---------|---------|---------|---------|
| [类型 A] | [方式] | [周期] | [限制] | [策略] |
| [类型 B] | [方式] | [周期] | [限制] | [策略] |

**数据库设计**（如适用）：
- **类型**: [SQLite/MySQL/等]
- **Schema**: [表结构说明]

---

## 6. 接口设计

### 6.1 模块间接口

#### 6.1.1 [接口组 A]

**协议定义**：

```
// 协议签名示例（根据语言调整）

protocol InterfaceName {
    func methodName(param: Type) -> ReturnType
    func asyncMethod(param: Type) async throws -> ReturnType
}
```

**接口清单**：

| 接口方法 | 功能描述 | 输入参数 | 返回值 | 异常 |
|---------|---------|---------|--------|------|
| methodA() | [描述] | [参数] | [返回] | [异常] |
| methodB() | [描述] | [参数] | [返回] | [异常] |

**使用约束**：
- [约束 1]: [说明]
- [约束 2]: [说明]

### 6.2 外部接口（如适用）

**API 定义**：

| 端点 | 方法 | 功能 | 请求格式 | 响应格式 |
|-----|------|------|---------|---------|
| /api/xxx | POST | [功能] | [格式] | [格式] |

### 6.3 数据格式

**关键数据结构**：

```json
// 示例 JSON 格式
{
  "field1": "type",
  "field2": 123,
  "nested": {
    "field3": "value"
  }
}
```

---

## 7. 关键流程设计

### 7.1 [核心流程 1 名称]

**流程图**：

```
[绘制流程图 - Mermaid]

示例：
flowchart TD
    Start([开始]) --> Step1[步骤1]
    Step1 --> Decision{判断}
    Decision -->|是| Step2[步骤2]
    Decision -->|否| Step3[步骤3]
    Step2 --> End([结束])
    Step3 --> End
```

**流程描述**：

1. **[步骤 1]**: [详细说明]
   - 输入: [数据]
   - 输出: [数据]
   - 异常: [处理方式]

2. **[步骤 2]**: [详细说明]

**性能考虑**：
- [考虑点 1]
- [考虑点 2]

### 7.2 [核心流程 2 名称]

[按照相同格式描述]

---

## 8. 风险与未决问题

### 8.1 技术风险

| 风险 ID | 风险描述 | 影响范围 | 严重程度 | 概率 | 缓解措施 |
|--------|---------|---------|---------|------|---------|
| R-001 | [风险描述] | [范围] | 高/中/低 | [概率] | [措施] |

### 8.2 依赖管理

**外部依赖**：

| 依赖项 | 版本 | 用途 | 风险 | 备选方案 |
|-------|------|------|------|---------|
| [库/服务] | vX.Y | [用途] | [风险] | [备选] |

### 8.3 未决问题

| 问题 ID | 问题描述 | 影响模块 | 优先级 | 负责人 | 状态 |
|--------|---------|---------|--------|--------|------|
| I-001 | [问题描述] | [模块] | P0/P1/P2 | @[人员] | 🔴/🟡/🟢 |

**状态说明**：
- 🔴 待决定：尚未开始讨论
- 🟡 讨论中：正在评估方案
- 🟢 已解决：已有明确决策

---

## 附录

### A. 术语表

| 术语 | 全称 | 定义 |
|------|------|------|
| [术语 1] | [全称] | [定义] |
| [术语 2] | [全称] | [定义] |

### B. 参考文档

**上游文档**：
- PRD: `docs/0_prd/prd_vX.Y.md`
- ADD: `docs/1_design/architecture/add-[name]-vX.Y.md`
- ADR: `docs/1_design/architecture/adr/[编号]-[标题].md`

**下游文档**：
- TDD: `docs/1_design/tdd/[module]-tdd-vX.Y.md`
- Sprint 计划: `docs/2_scrum/[platform]/sprint-plan-vX.Y.md`

**外部参考**：
- [参考资料 1]: [链接]
- [参考资料 2]: [链接]

---

**模板版本**: v2.0 (精简版)  
**最后更新**: 2025-11-11  
**维护**: @架构团队

**使用说明**：
1. 复制本模板创建新 HLD 文档
2. 删除所有 `[]` 占位符，填入实际内容
3. 根据项目复杂度决定是否需要可选章节
4. 完成后提交 PR 进行评审
