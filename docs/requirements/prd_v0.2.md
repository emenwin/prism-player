# Prism Player 产品需求文档（PRD）

> 版本：v0.2  
> 日期：2025-10-17  
> 文档定位：仅定义产品“做什么/为什么”，不含实现细节与技术设计（这些将在 TDD/HLD 中阐述）

## 1. 背景与目标

Prism Player 是一款本地音视频播放器，支持在设备上离线（或低网络依赖）将媒体中的语音转文字（ASR），并与播放进度同步显示字幕。产品核心价值：在无需上传数据的前提下，为无字幕或外语内容提供可用、可控、隐私友好的字幕体验。

- 目标
  - 从本地媒体提取音频并进行端侧识别，生成带时间戳的字幕。
  - 播放过程中边播边出字，保证“看得上”和“看得懂”。
  - 提供基础的字幕样式管理与文件导出，便于学习与复用。
- 用户价值
  - 学习外语/专业内容时快速理解要点。
  - 为创作者提供可编辑的草稿字幕基础。
  - 提升无障碍可达性（Accessibility）。

## 2. 成功指标（KPI）与性能分级

为避免“典型设备”歧义，按设备档位设定可衡量指标（以端侧轻量模型为基准，实际依设备与模型选择而定）：

- 设备档位定义（用于度量，不体现在 UI）：
  - 高端：近两年旗舰机型（同级 iPhone 13 Pro+/Snapdragon 888+）。
  - 中端：近三年主流机型（同级 iPhone 12/13、Snapdragon 7 系）。
  - 入门：较早或入门级机型（同级 iPhone SE 2020、Snapdragon 6 系）。
- 指标目标（P95）：
  - 首帧字幕可见时间（选中媒体至首条字幕展示）
    - 高端 ≤ 5s；中端 ≤ 8s；入门 ≤ 12s（必要时提示降级方案）。
  - 字幕时间同步偏差：≤ ±200ms。
  - 本地处理率（RTF, Realtime Factor）
    - 高端 ≥ 1.0；中端 ≥ 0.5；入门 ≥ 0.3。
- 稳定性与体验
  - 播放过程中字幕连续可见；缺字时展示状态占位并尽快补齐。
  - 导出成功率 ≥ 99%。

说明：不同模型与语言会影响表现。应用需引导用户选择更合适的模型以平衡“速度/精度/体积”。

## 3. 范围（Scope）

- In Scope（首期）
  - 本地媒体选择与播放（视频/音频）。
  - 音频预加载与滚动提取，用于快速出字与持续识别。
  - 端侧 ASR 与字幕生成（带时间戳）。
  - 字幕展示与基础样式（字号、主题、背景）。
  - 字幕导出（SRT 必选，VTT 作为增强）。
  - 模型管理（下载/导入/删除）、语言选择、缓存管理。
  - 国际化（至少中英）与可访问性基线支持。
- Out of Scope（首期不包含）
  - 云端识别与账户系统。
  - 高级字幕编辑（逐词级修订、对齐校正）。
  - 说话人分离（Diarization）、机器翻译字幕。
  - 视频“字幕烧录导出”。

## 4. 用户画像与使用场景

- 学习者：观看外语/无字幕视频，期待快速获得基础字幕辅助理解。
- 创作者：为素材生成草稿字幕，后续在桌面端精修。
- 听障用户：依赖字幕提升可达性。

典型场景
- 选择本地视频 → 几秒内出现首条字幕 → 播放中滚动生成字幕。
- 长视频边播边识别 → 完播后导出全片字幕。
- 进度拖动到新位置 → 优先出当前窗口字幕 → 缺口“处理中”。

## 5. 用户故事与验收标准（AC）

1) 作为用户，我可以在选择媒体后很快看到首条字幕。
- AC1：首帧字幕可见时间符合第 2 章分级目标（P95）。
- AC2：失败时有明确状态提示与重试入口；不会阻塞播放。

2) 作为用户，我在播放过程中可以持续看到新的字幕滚动生成。
- AC1：播放中的当前时间窗口字幕优先生成与渲染。
- AC2：缺失片段显示“字幕加载中…”占位，补齐后自动替换。

3) 作为用户，我可以拖动进度条并在新位置尽快获得字幕。
- AC1：进度变更后，系统抢占式优先识别“当前时间点起后 60s（可调）”窗口。
- AC2：已识别片段优先展示，未识别片段显示占位状态。

4) 作为用户，我可以调整字幕样式并开关字幕显示。
- AC1：支持字号 3 档、浅/深主题与半透明背景；设置持久化。
- AC2：切换样式不影响播放和识别进程。

5) 作为用户，我可以导出字幕文件用于其他工具。
- AC1：支持 SRT；可选支持 VTT；编码 UTF-8；含起止时间与文本。
- AC2：命名避免覆盖源文件，导出前检查空间充足。

6) 作为用户，我可以在离线情况下使用识别能力。
- AC1：模型安装后可全程离线识别；首装时支持“本地导入”或“在网络可用时一键下载”。
- AC2：权限请求最小化且可理解（仅文件访问）。

7) 作为用户，我可以在应用进入后台时继续识别（在系统允许范围内）。
- AC1：后台继续执行识别任务（可降低优先级），回到前台时进度衔接自然。
- AC2：系统限制导致暂停时，应用提供清晰的状态提示与恢复策略。

8) 作为用户，我可以了解字幕质量与做出改进选择。
- AC1：低置信度片段以弱提示样式标注（如颜色/透明度），不干扰观看。
- AC2：为特定片段提供“重新识别（更高精度模型）”入口（可选）。

## 6. 功能需求（FRD）

### 6.1 媒体选择与播放
- 支持常见本地媒体文件选择与播放；提供播放/暂停、拖动、倍速（0.5–2.0x）。
- 进度变化事件对字幕渲染有确定行为（见 6.4）。

### 6.2 音频预加载与缓存策略（产品级要求）
- 预加载窗口：默认 30s，可在 10–60s 范围内配置。
- 滚动缓存：播放期间按 15–30s 段滚动提取音频用于识别。
- 缓存上限：音频缓存与中间结果总占用建议 ≤ 10MB；超出采用 LRU 淘汰。
- 内存压力响应：收到系统内存警告时，保留“当前播放 ±15s”最小缓存，立即释放其他缓存。
- 长视频策略：对 >1 小时内容仅按需提取与持久化字幕结果，避免全量内存占用。

### 6.3 模型管理与分发（关键决策）
- 决策：不预置完整大模型，避免体积与授权风险；内置超轻量模型用于 Demo（如仅英文，小体积）。
- 首次体验：提供清晰引导 → 选项 A 一键下载合规来源的模型（在网络可用时）；选项 B 本地导入模型文件。
- 下载与存储：展示模型大小、预计时间；下载过程中显示进度、暂停/重试；存储空间不足时给出提示并允许清理。
- 校验与状态：完成后进行完整性校验（如校验和）、记录版本与语言范围；模型状态清晰（未安装/等待/下载中/失败/已就绪）。
- 管理与清理：支持删除已安装模型以释放空间；保留至少一个可用模型以保障可用性。
- 语言与速度：支持自动检测或手动指定语言；在 UI 提示“指定语言可能更快更准”。

### 6.4 字幕生成与同步显示
- 结果形态：由带起止时间的片段构成；片段顺序稳定，支持相邻合并与断句优化（适度）。
- 同步原则：字幕以播放器的当前时间为唯一时钟源，偏差容差 ≤ ±200ms。
- 倍速播放：字幕显示时长与播放速度等比缩放；当识别速度明显落后时提示用户调整倍速或切换更快模型。
- 进度拖动：暂停当前渲染 → 定位新时间 → 立即展示已识别片段；对未识别区域显示“加载中”，并按“当前点起后 60s”窗口抢占识别。
- 缺失片段：不以错误内容充填；失败段允许重试。

### 6.5 字幕展示与样式
- 位置：底部居中、安全区内，避免与系统手势冲突。
- 样式：字号三档、浅/深主题、半透明背景；设置持久化。
- 开关：字幕可独立开/关，默认开启。

### 6.6 字幕导出
- 支持 SRT；VTT 作为增强选项。
- 文件命名：<源文件名>.<语言/locale>.srt；编码 UTF-8。
- 导出前空间检查；失败时给出可恢复的提示与重试。

### 6.7 设置与偏好
- 模型：选择、下载/导入、删除、查看版本与大小。
- 语言：自动/指定；记住最近一次选择。
- 预加载时长：10/30/60s。
- 缓存管理：一键清理识别产生的临时文件与中间结果。

### 6.8 错误处理与状态反馈
- 统一状态：等待中/进行中/成功/失败；在播放页以轻量方式提示，不遮挡内容。
- 错误类别：媒体不支持、空间不足、模型缺失/损坏、权限拒绝、后台受限等；面向用户给出可理解文案与建议。
- 诊断导出：提供“问题反馈包”导出开关，包含配置、设备与版本、关键时序（脱敏，不含原媒体内容）。

### 6.9 字幕质量感知与用户反馈（增强）
- 低置信度轻提示样式（不强打断）。
- “重新识别（更高精度）”入口（按段），并提示耗时/电量开销。
- 简单评分（1–5 星）可选，用于指导模型推荐（本地统计）。

## 7. 非功能需求（NFR）

- 性能与可用性
  - 指标与分级见第 2 章；各档位在目标设备上达标或给出降级提示。
  - 播放界面滚动与渲染流畅，交互无明显阻塞。
- 资源与能耗
  - 缓存上限与内存压力处理如 6.2；长任务节能策略（段间节流）。
- 隐私与合规
  - 默认离线工作；不上传音视频或字幕内容。
  - 提供缓存清理与模型删除；第三方许可在“关于”页披露（不在本 PRD详述）。
- 稳定性
  - 崩溃率低于行业基线；失败重试具备幂等与可恢复性。
- 国际化（i18n）
  - 所有用户可见文案均使用国际化资源；首期支持中文（简体）与英文（美国）。
  - 不允许硬编码字符串；日期/数字/方向性遵循系统区域设置。
- 可访问性（a11y）
  - 支持动态字体；色彩对比达标；屏幕阅读器可读关键控件与状态。
  - 是否朗读字幕与原音频可能冲突，提供显式开关并默认关闭。
- 后台行为
  - 在系统允许的前提下持续识别；受限时清晰提示并可恢复。
- 工程与规范（仅约束，不含实现细节）
  - 禁用硬编码字符串；遵循平台 Lint 规范；隐私合规与许可披露。

## 8. 关键交互与用户流程（用户视角）

1) 首次启动与模型准备
- 欢迎页 → 选择“下载模型”或“本地导入” → 展示大小/用时与进度 → 完成校验 → 进入播放器。

2) 播放与快速出字
- 选择媒体 → 解析基本信息 → 预加载音频（默认 30s）→ 开始识别 → 播放开始 → 首条字幕展示。

3) 播放中滚动识别
- 按段产生字幕 → 即时渲染 → 失败段重试/降级。

4) 进度拖动与抢占识别
- 拖动进度 → 定位新窗口 → 立即展示已识别片段 → 对未识别区域优先识别当前点后 60s。

5) 导出与分享（文件层面）
- 汇总字幕 → 生成 SRT/VTT → 存储与系统分享（如适用）。

6) 缓存与模型管理
- 设置页查看与管理模型/缓存；空间不足时提供清理入口。

## 9. 数据版本与迁移（产品要求）

- 本地数据（设置、模型清单、缓存索引、字幕结果）带版本号存储。
- 应用升级时自动迁移旧版本数据；不兼容时给出温和提示并提供备份/重建路径。
- 模型版本与兼容性校验，避免因不兼容模型导致功能不可用。

## 10. 分阶段里程碑（2–4 周/迭代）

- M1 原型
  - 本地播放、音频预加载、离线最小模型识别、基础字幕渲染、SRT 导出（基础）。
- M2 可用版
  - 增量识别与滚动字幕、模型管理（下载/导入/删除）、语言选择、缓存管理、一键清理、倍速播放适配、VTT（可选）。
- M3 优化版
  - 性能与能耗优化、进度拖动抢占识别、可访问性完善、故障与错误码体系、质量感知与按段重识别、稳定性与长视频策略完善。

## 11. 验收标准（汇总）

- 功能：第 5 章用户故事全部通过；Out of Scope 不提前引入。
- 性能：第 2 章分级指标在目标设备上达标；提供监测与用户提示。
- 隐私：全程离线（模型下载/导入除外）；提供清理工具。
- i18n/a11y：禁用硬编码；中英双语齐备；动态字体、屏幕阅读器与对比度达标。
- 导出：SRT 正确、编码 UTF-8、时间戳准确；失败可重试。
- 稳定性：长视频与后台场景验证，无明显资源泄露与崩溃热点。

## 12. 风险与关键决策记录

- 决策：不预置完整大模型；内置超轻量演示模型；优先引导下载或本地导入。
- 风险：
  - 低端设备性能不足 → 提供模型降级与倍速提醒。
  - 存储空间压力 → 明确模型体积提示与清理工具。
  - 语言自动检测误差 → 推荐手动选择语言并记住偏好。
  - 系统后台限制 → 明确预期与状态提示，提供恢复策略。

## 13. 指标与本地分析（不出网）

- 关键指标：首帧时间、RTF、识别段耗时、识别失败率、导出使用率、模型选择分布。
- 问题反馈包（可选）：包含设备信息（匿名）、版本、配置与时序日志（脱敏）。

— 完 —
