# Sprint 1b - 播放器基础功能

## 📋 概述

**Sprint 周期**: 2025-11-14 ~ 2025-11-27（2 周）  
**优先级**: 高（P0）  
**前置条件**: Sprint 1 完成  
**后续 Sprint**: Sprint 2

## 🎯 目标

完成播放器基础播放功能（优先 macOS），为 Sprint 2 的 ASR 集成测试提供稳定的播放器基础。

## 📌 背景

Sprint 1 完成了 ASR 核心能力：
- ✅ 音频抽取与预加载
- ✅ WhisperCpp 后端集成
- ✅ 字幕生成与持久化
- ✅ SRT 导出

但播放器功能相对简化，缺少：
- ❌ 完整的播放控件（进度条、时间显示、倍速等）
- ❌ SRT 外部字幕加载与显示
- ❌ 精确的视频拖动处理
- ❌ 字幕时间同步机制

为了在 Sprint 2 进行完整的集成测试（增量识别 + 播放器联动），需要先完善播放器基础能力。

## 🎯 核心交付物

### 1. 播放控件增强（8 SP）
- 播放/暂停按钮、进度条、时间显示
- 播放速度选择（0.5x-2.0x）
- 键盘快捷键（macOS）
- 全屏/窗口化切换

### 2. SRT 字幕加载（5 SP）
- SRTParser 实现
- 支持多种编码
- 自动加载同名字幕
- 错误处理与状态管理

### 3. SRT 字幕显示（8 SP）
- SubtitleRenderer 组件
- 时间同步（±50ms）
- 字幕样式与动画
- macOS/iOS 适配

### 4. 视频拖动处理（8 SP）
- 平滑的进度条拖动
- 精确跳转（±100ms）
- 字幕同步更新
- 防抖优化

## 📊 任务分解

| 任务 ID | 任务名称 | 故事点 | 状态 |
|---------|----------|--------|------|
| Task-1b01 | 视频选择功能 | 5 SP | ✅ 完成 |
| Task-1b02 | 播放控件增强 | 8 SP | ⏳ 待开始 |
| Task-1b03 | SRT 字幕加载 | 5 SP | ⏳ 待开始 |
| Task-1b04 | SRT 字幕显示 | 8 SP | ⏳ 待开始 |
| Task-1b05 | 视频拖动处理 | 8 SP | ⏳ 待开始 |
| **总计** | | **34 SP** | |

## 🔗 依赖关系

### 前置依赖
- Sprint 0: 工程基线 ✅
- Sprint 1: ASR 核心能力 ✅

### 依赖图
```
Task-1b01 (视频选择) ✅
  ├── Task-1b02 (播放控件) ⏳
  │     ├── Task-1b04 (字幕显示) ⏳
  │     └── Task-1b05 (拖动处理) ⏳
  └── Task-1b03 (SRT 加载) ⏳
        └── Task-1b04 (字幕显示) ⏳
```

### 后续依赖
Sprint 2 的以下任务依赖 Sprint 1b：
- Task-201: 增量识别与滚动字幕
- Task-205: 倍速播放适配
- Task-207: macOS 目标最小可用
- Task-213: 端到端集成测试

## 📅 时间线

### Week 1（2025-11-14 ~ 2025-11-20）
- Task-1b02: 播放控件增强 ✅
- Task-1b03: SRT 字幕加载 ✅

### Week 2（2025-11-21 ~ 2025-11-27）
- Task-1b04: SRT 字幕显示 ✅
- Task-1b05: 视频拖动处理 ✅
- 集成测试

## ✅ 完成标准（DoD）

### 功能完整性
- [ ] 所有播放控件正常工作
- [ ] SRT 字幕正确加载与显示
- [ ] 进度拖动与字幕精确同步
- [ ] macOS 版本完整可用
- [ ] iOS 版本基础可用（可选）

### 质量保证
- [ ] 单元测试覆盖率 ≥80%（SRT 解析）
- [ ] 集成测试：播放 → 加载字幕 → 拖动 → 验证同步
- [ ] SwiftLint 严格模式通过
- [ ] 无已知 P0/P1 缺陷

### 文档与可维护性
- [ ] API 文档完整
- [ ] 代码注释清晰（中文）
- [ ] 用户手册更新（播放器使用）

## 🎯 成功指标

- **时间同步精度**: ±50ms（P95）
- **Seek 精度**: ±100ms
- **UI 响应时间**: <100ms
- **SRT 解析成功率**: >99%

## 🚨 风险与缓解

### 高风险项
1. **跨平台 UI 适配复杂**
   - 缓解：优先 macOS，iOS 可简化
   
2. **SRT 编码兼容性**
   - 缓解：优先 UTF-8，其他编码可选
   
3. **字幕同步性能**
   - 缓解：优先正确性，性能优化可迭代

## 📚 参考文档

- [Sprint 1b 任务列表](sprint-1b-task-list.md)
- [PRD v0.2](../../../0_prd/prd_v0.2.md) - §6.1, §6.5
- [Sprint 计划](../sprint-plan-v0.2-updated.md) - §3.5
- [Sprint 1 总结](../sprint-1/sprint-1-task-list.md)

## 📝 变更日志

### 2025-11-13
- 创建 Sprint 1b 计划
- 定义 5 个核心任务（34 SP）
- 确定与 Sprint 2 的依赖关系
