# Sprint 2 Task 列表

**Sprint 周期**: 2025-11-28 ~ 2025-12-23（预估 3.5-4 周）  
**Sprint 目标**: 完成滚动增量识别与模型管理，改善使用体验与可用性，支持 macOS 基线，并落实后台与并发策略  
**总故事点**: 75 SP（不含可选 Spike）

**前置条件**: Sprint 1b 完成（播放器基础功能）

---

## 📊 进度概览

| 状态 | 任务数 | 故事点 | 占比 |
|------|--------|--------|------|
| ✅ 完成 | 0 | 0 SP | 0% |
| 🚧 进行中 | 0 | 0 SP | 0% |
| ⏳ 待开始 | 16 | 75 SP | 100% |

**最后更新**: 2025-10-29

---

## 📋 任务清单

### 核心功能（P0）

#### Task-201: 增量识别与滚动字幕
- **故事点**: 13 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-101 (已完成), Sprint 1b (播放器基础)
- **验收标准**:
  - [ ] 按 15–30s 段滚动抽取与识别
  - [ ] 增量落盘并驱动 UI
  - [ ] 滚动字幕平滑显示
  - [ ] 与播放器控件集成（播放/暂停/Seek 联动）
- **参考**: PRD §6.4, US §5-2, HLD §5
- **相关文件**: `PrismASR/`, `PrismCore/`, `PrismPlayer/`

---

#### Task-202: 进度拖动后的优先识别（基础版）
- **故事点**: 8 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-201, Task-210 (JobScheduler)
- **验收标准**:
  - [ ] Seek 后展示已识别片段
  - [ ] 未识别片段显示占位
  - [ ] 队列对"seek 点起后窗口"提高优先级（简化版）
- **参考**: PRD §5-3, §6.4
- **相关文件**: `PrismCore/Sources/Services/`

---

#### Task-203: 缓存与内存策略（基础）
- **故事点**: 8 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-201
- **验收标准**:
  - [ ] 音频缓存 ≤10MB，LRU 淘汰
  - [ ] 内存警告仅保留"当前 ±15s"
  - [ ] 内存监控与清理策略
- **参考**: PRD §6.2, HLD §7
- **相关文件**: `PrismCore/Sources/Storage/`

---

#### Task-204: 模型管理（下载/导入/删除）与语言选择
- **故事点**: 13 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: 无
- **验收标准**:
  - [ ] 展示大小/进度/校验（SHA256）
  - [ ] 空间检查
  - [ ] 至少保留一个可用模型
  - [ ] 语言自动/手动选择与持久化
  - [ ] `ModelMetadata` 增加 `backend: AsrBackend` 与 `supportsTimestamps: Bool` 字段
- **参考**: PRD §6.3, §6.7
- **相关文件**: `PrismCore/Sources/Models/`, `PrismASR/Sources/`

---

#### Task-205: 倍速播放适配（0.5–2.0x）
- **故事点**: 5 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-101, Task-201, Sprint 1b (播放器控件)
- **验收标准**:
  - [ ] 字幕显示时长与播放速度等比
  - [ ] 识别明显落后时弱提示
  - [ ] 倍速控制 UI（已在 Sprint 1b 完成基础）
  - [ ] ASR 字幕与倍速同步测试
- **参考**: PRD §6.1, §6.4
- **相关文件**: `PrismPlayer/Sources/`

---

#### Task-206: VTT 导出（可选增强）
- **故事点**: 3 SP
- **状态**: ⏳ 待开始
- **优先级**: P1（可选）
- **依赖**: Task-101（SRT 导出）
- **验收标准**:
  - [ ] WebVTT 格式正确
  - [ ] UTF-8 编码
  - [ ] 时间戳格式正确
  - [ ] 样式支持（可选）
- **参考**: PRD §6.6
- **相关文件**: `PrismCore/Sources/Export/`

---

#### Task-207: macOS 目标最小可用
- **故事点**: 6 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-101, Task-201, Sprint 1b (macOS 播放器)
- **验收标准**:
  - [ ] 基于 Sprint 1b 的 macOS 播放器
  - [ ] 集成 ASR 识别功能
  - [ ] 字幕渲染（ASR + SRT 双模式）
  - [ ] 导出功能（SRT）
  - [ ] UI 适配 macOS 人机界面指南
- **参考**: HLD §3
- **相关文件**: `PrismPlayer/Sources/`, `PrismKit/`

---

#### Task-208: 设置页与一键清理
- **故事点**: 5 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-203, Task-204
- **验收标准**:
  - [ ] 预加载时长 10/30/60s 设置
  - [ ] 缓存清理功能
  - [ ] 最近语言与模型记忆
  - [ ] 设置持久化
- **参考**: PRD §6.7
- **相关文件**: `PrismPlayer/Sources/Settings/`

---

#### Task-209: 指标与离线统计（基础）
- **故事点**: 3 SP
- **状态**: ⏳ 待开始
- **优先级**: P1
- **依赖**: 无（已有 MetricsCollector）
- **验收标准**:
  - [ ] 首帧、RTF、段失败率本地记录
  - [ ] 问题反馈包开关雏形（不含原媒体）
  - [ ] 统计数据可视化
- **参考**: PRD KPI
- **相关文件**: `PrismCore/Sources/Metrics/`

---

#### Task-210: JobScheduler 基础实现
- **故事点**: 8 SP
- **状态**: ⏳ 待开始
- **优先级**: P1
- **依赖**: 无
- **验收标准**:
  - [ ] 优先级：抢占（seek）> 滚动 > 预加载
  - [ ] 取消机制
  - [ ] Actor 封装
  - [ ] 无死锁单测
- **参考**: HLD §2.2
- **相关文件**: `PrismCore/Sources/Services/JobScheduler.swift`

---

#### Task-211: 后台行为与能耗策略
- **故事点**: 13 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-201, Task-210
- **验收标准**:
  - [ ] iOS: Audio 背景模式下持续识别
  - [ ] iOS: 非播放态规划 BGProcessingTask（可推迟实现）
  - [ ] iOS: 低电量/温度降速策略
  - [ ] macOS: `NSProcessInfo.beginActivity` 抑制 App Nap
  - [ ] macOS: 屏幕关闭策略
  - [ ] 回到前台进度衔接
  - [ ] 低电量提示与降速
  - [ ] 基础能耗记录
- **参考**: PRD §7, HLD §10
- **相关文件**: `PrismCore/Sources/Platform/`

---

#### Task-212: 性能监控与降级逻辑（基础）
- **故事点**: 5 SP
- **状态**: ⏳ 待开始
- **优先级**: P2
- **依赖**: Task-209
- **验收标准**:
  - [ ] PerformanceMonitor 采集 RTF/内存/电量
  - [ ] 阈值：RTF<0.3 → 提示换模型
  - [ ] 内存警告 → LRU 清理
  - [ ] 性能监控 UI
- **参考**: HLD §6.7
- **相关文件**: `PrismCore/Sources/Metrics/PerformanceMonitor.swift`

---

#### Task-213: 端到端集成测试与 a11y 测试
- **故事点**: 8 SP
- **状态**: ⏳ 待开始
- **优先级**: P2
- **依赖**: Task-201, Task-207, Sprint 1b (完整播放器)
- **验收标准**:
  - [ ] 场景测试：选择媒体→首帧→滚动→seek→导出→验证文件（iOS+macOS）
  - [ ] 播放器控件集成测试：播放/暂停/Seek/倍速 + ASR 联动
  - [ ] SRT 字幕与 ASR 字幕切换测试
  - [ ] a11y：VoiceOver 朗读关键控件
  - [ ] a11y：动态字体 3 档
  - [ ] a11y：高对比度
  - [ ] 自动化测试用例
- **参考**: DoD, Sprint 1b 播放器基础
- **相关文件**: `Tests/Integration/`

---

#### Task-214: 字幕翻译基础版
- **故事点**: 8 SP
- **状态**: ⏳ 待开始
- **优先级**: P0
- **依赖**: Task-201
- **验收标准**:
  - [ ] TranslationEngine 协议定义
  - [ ] 最小本地 NMT 后端（英→中）实现
  - [ ] 流水线：ASR 片段产出后进入翻译队列
  - [ ] 优先"当前窗口"，未完成显示"翻译中…"
  - [ ] 设置：字幕语言选择（原文/翻译 zh-Hans/（可选）双语）
  - [ ] 导出：支持选择译文轨导出，命名包含目标语言
  - [ ] 测试：协议契约测试 + 金样本（英→中 30s ×3 段）
  - [ ] 译文正确性与时间对齐（±200ms）
- **参考**: PRD §6.10, HLD §2/§5/§12
- **相关文件**: `PrismCore/Sources/Translation/`

---

### 可选 Spike（P1）

#### Task-215: MLX Swift 后端评估 Spike
- **故事点**: 5 SP
- **状态**: ⏳ 待开始
- **优先级**: P1（可选，时间盒 3 天）
- **依赖**: 无
- **验收标准**:
  - [ ] macOS Apple Silicon 优先
  - [ ] 实现 `AsrEngine` 协议最小推理
  - [ ] 与 whisper.cpp 对比样本
  - [ ] 性能与精度报告
- **参考**: HLD §6.2
- **相关文件**: `PrismASR/Sources/Backend/`

---

#### Task-216: VAD + 对齐方案评估 Spike
- **故事点**: 5 SP
- **状态**: ⏳ 待开始
- **优先级**: P1（可选，时间盒 3–5 天）
- **依赖**: 无
- **验收标准**:
  - [ ] 评估 WebRTC/Silero VAD
  - [ ] 短窗推理 + 切段 + 简易对齐（DTW/能量峰值）
  - [ ] 精度报告与回退策略
  - [ ] 技术可行性结论
- **参考**: HLD 讨论清单
- **相关文件**: `PrismASR/Sources/VAD/`

---

## 📅 里程碑检查点

### Week 1（2025-11-28 ~ 2025-12-04）
- [ ] Task-210: JobScheduler 基础实现（8 SP）
- [ ] Task-201: 增量识别与滚动字幕 开始（13 SP）
- [ ] Sprint 1b 成果集成验证

### Week 2（2025-12-05 ~ 2025-12-11）
- [ ] Task-201: 增量识别与滚动字幕 完成
- [ ] Task-204: 模型管理 开始（13 SP）
- [ ] Task-203: 缓存与内存策略（8 SP）

### Week 3（2025-12-12 ~ 2025-12-18）
- [ ] Task-204: 模型管理 完成
- [ ] Task-211: 后台行为与能耗策略（13 SP）
- [ ] Task-207: macOS 目标最小可用（6 SP）
- [ ] Task-214: 字幕翻译基础版 开始（8 SP）

### Week 4（2025-12-19 ~ 2025-12-23）
- [ ] Task-214: 字幕翻译基础版 完成
- [ ] Task-202: 进度拖动后的优先识别（8 SP）
- [ ] Task-213: 端到端集成测试与 a11y 测试（8 SP）
- [ ] 其余小任务收尾（Task-205, 208, 209, 212）

---

## 🎯 Sprint 2 关键目标

1. **增量识别**: 滚动字幕流畅显示
2. **模型管理**: 完整的下载/导入/删除流程
3. **macOS 支持**: 基线功能可用
4. **后台策略**: iOS/macOS 后台持续识别
5. **翻译能力**: 英→中基础翻译
6. **质量保障**: E2E 测试 + a11y 测试

---

## 📊 风险与依赖

### 前置依赖
- **Sprint 1b 完成**: 播放器基础功能必须完成，包括：
  - 完整播放控件（播放/暂停/Seek/倍速/时间显示）
  - SRT 字幕加载与显示
  - 视频拖动处理
  - 字幕时间同步机制

### 高风险项
- **Task-211 (后台)**: iOS 系统后台限制，需充分测试
- **Task-214 (翻译)**: 模型选择与质量平衡
- **Task-201 (增量)**: 性能与流畅度挑战，需与播放器紧密集成

### 跨任务依赖
```
Sprint 1b (播放器基础) [前置条件]
  │
Task-101 (已完成)
  ├── Task-201 (增量识别) [依赖 Sprint 1b]
  │     ├── Task-202 (优先识别)
  │     ├── Task-203 (缓存策略)
  │     ├── Task-205 (倍速) [依赖 Sprint 1b 控件]
  │     ├── Task-207 (macOS) [依赖 Sprint 1b macOS 播放器]
  │     └── Task-214 (翻译)
  ├── Task-210 (JobScheduler)
  │     ├── Task-202 (优先识别)
  │     └── Task-211 (后台)
  └── Task-204 (模型管理)
        └── Task-208 (设置)
```

---

## 📝 更新日志

### 2025-11-13
- 调整 Sprint 周期为 2025-11-28 ~ 2025-12-23（Sprint 1b 插入后顺延）
- 添加 Sprint 1b 前置依赖说明
- 更新相关任务依赖关系：
  - Task-201: 依赖 Sprint 1b 播放器基础
  - Task-205: 依赖 Sprint 1b 播放器控件
  - Task-207: 依赖 Sprint 1b macOS 播放器
  - Task-213: 依赖 Sprint 1b 完整播放器
- 更新里程碑检查点日期

### 2025-10-29
- 创建 Sprint 2 Task 列表
- 根据 sprint-plan-v0.2-updated.md 拆分 16 个任务
- 设定初始优先级和依赖关系
- 制定 4 周里程碑检查点

---

## 📖 参考文档

- **Sprint 1b 计划**: `docs/2_scrum/iOS-macOS/sprint-1b/sprint-1b-task-list.md` ⭐ 前置依赖
- **Sprint 计划**: `docs/2_scrum/iOS-macOS/sprint-plan-v0.2-updated.md`
- **PRD**: `docs/0_prd/prd_v0.2.md`
- **HLD**: `docs/1_design/hld/iOS-macOS/hld-ios-macos-v0.2.md`
- **Task 模板**: `docs/template/8.task-detailed.template.md`
- **Sprint 1 总结**: `docs/2_scrum/iOS-macOS/sprint-1/sprint-1-task-list.md`
